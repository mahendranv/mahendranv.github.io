<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="GraphQL backend — pagination &amp; filters" /><meta property="og:locale" content="en" /><meta name="description" content="GraphQL pagination and filter setup" /><meta property="og:description" content="GraphQL pagination and filter setup" /><link rel="canonical" href="https://mahendranv.github.io/posts/2021-05-25-gql-filters-pagination/" /><meta property="og:url" content="https://mahendranv.github.io/posts/2021-05-25-gql-filters-pagination/" /><meta property="og:site_name" content="Mahendran" /><meta property="og:image" content="https://mahendranv.github.io/assets/img/covers/gql_filters_pagination.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-05-25T00:00:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://mahendranv.github.io/assets/img/covers/gql_filters_pagination.jpg" /><meta property="twitter:title" content="GraphQL backend — pagination &amp; filters" /><meta name="twitter:site" content="@mahevelai" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-06-02T22:38:30+05:30","datePublished":"2021-05-25T00:00:00+05:30","description":"GraphQL pagination and filter setup","headline":"GraphQL backend — pagination &amp; filters","image":"https://mahendranv.github.io/assets/img/covers/gql_filters_pagination.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://mahendranv.github.io/posts/2021-05-25-gql-filters-pagination/"},"url":"https://mahendranv.github.io/posts/2021-05-25-gql-filters-pagination/"}</script><title>GraphQL backend — pagination & filters | Mahendran</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mahendran"><meta name="application-name" content="Mahendran"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/614333/01be055d-c668-46ba-8f7b-54065256c70d.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Mahendran</a></div><div class="site-subtitle font-italic">Android | Kotlin | Springboot | DGS</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/series/" class="nav-link"> <i class="fa-fw fas fas fa-list-ol ml-xl-3 mr-xl-3 unloaded"></i> <span>SERIES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/mahendranv" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/mahevelai" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://dev.to/mahendranv" aria-label="dev.to" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-dev"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>GraphQL backend — pagination & filters</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>GraphQL backend — pagination & filters</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Mahendran Vadivalagan </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, May 25, 2021, 12:00 AM +0530" >May 25, 2021<i class="unloaded">2021-05-25T00:00:00+05:30</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 2, 2021, 10:38 PM +0530" >Jun 2, 2021<i class="unloaded">2021-06-02T22:38:30+05:30</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1842 words">10 min read</span></div></div><div class="post-content"><h2 id="background">Background</h2><p>Pagination and filters are the much needed components when it comes to listing. They not only narrow down the list for the user, but improves load time and save user from scanning through lots of pages. Overall content engagement will improve when the list is on point and incrementally loaded in small chunks. This post covers setup &amp; implementation of pagination in springboot-graphql environment.</p><p>Sample project used in this post is available in <a href="https://github.com/mahendranv/spring-expenses">Github</a>. Project overall architucture is in below diagram.</p><p><img data-proofer-ignore data-src="/assets/img/2021-05-26-00-03-41.png" alt="" /></p><ul id="markdown-toc"><li><a href="#background" id="markdown-toc-background">Background</a><li><a href="#project-overview" id="markdown-toc-project-overview">Project overview</a><li><a href="#project-setup" id="markdown-toc-project-setup">Project setup</a><ul><li><a href="#database" id="markdown-toc-database">Database</a><li><a href="#orm--jpa-repository" id="markdown-toc-orm--jpa-repository">ORM — JPA repository</a><li><a href="#graphql-setup" id="markdown-toc-graphql-setup">GraphQL setup</a></ul><li><a href="#pagination-and-filter-setup" id="markdown-toc-pagination-and-filter-setup">Pagination and Filter setup</a><ul><li><a href="#what-paginates-the-data-source" id="markdown-toc-what-paginates-the-data-source">What paginates the data source?</a><li><a href="#schema" id="markdown-toc-schema">Schema</a><li><a href="#data-fetchers" id="markdown-toc-data-fetchers">Data fetchers</a></ul><li><a href="#run-it" id="markdown-toc-run-it">Run it</a><li><a href="#summary" id="markdown-toc-summary">Summary</a></ul><h2 id="project-overview">Project overview</h2><p>Basic project setup involves a database, ORM and graphql to compose the response. <em>H2</em> is a lightweight relational database that is a goto option for casual projects. ORM — [Object–relational mapping] is a technique that connects object to the database. With ORM, database can be accessed without the need of writing any query. <em>JPA</em> — (Java Persistence API) is used in this project for accessing the database. <em>Netflix-DGS</em> framework is used for GraphQL setup — it is a superset of java-graphql implementation.</p><h2 id="project-setup">Project setup</h2><h3 id="database">Database</h3><p>H2 database requires way less setup compared to others. H2 is added as a runtime dependency to the application and will be availble to use when the application starts. Following dependency enables the h2-driver to connect with our database.</p><div class="language-groovy highlighter-rouge"><div class="code-header"> <span text-data=" Groovy "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">dependencies</span> <span class="o">{</span>
 <span class="o">...</span>
 <span class="n">runtimeOnly</span><span class="o">(</span><span class="s2">"com.h2database:h2"</span><span class="o">)</span>

<span class="o">}</span>

</pre></table></code></div></div><p>Now that our app knows the H2 driver, it needs the database url and credentials to connect with it. Adding the following properties tells springboot to use h2 driver and use the given credentials.</p><div class="language-properties highlighter-rouge"><div class="code-header"> <span text-data=" Properties "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="err">//</span><span class="py">File</span><span class="p">:</span><span class="s">"application.properties"</span>

<span class="c"># Driver
</span><span class="py">spring.datasource.driverClassName</span><span class="p">=</span><span class="s">org.h2.Driver</span>
<span class="py">spring.datasource.url</span><span class="p">=</span><span class="s">jdbc:h2:file:~/be/db/expenses;AUTO_SERVER=true</span>
<span class="py">spring.datasource.username</span><span class="p">=</span><span class="s">sa</span>
<span class="py">spring.datasource.password</span><span class="p">=</span><span class="s">password</span>
<span class="py">spring.jpa.database-platform</span><span class="p">=</span><span class="s">org.hibernate.dialect.H2Dialect</span>

<span class="c"># Table creation from entity classes
</span><span class="py">spring.jpa.hibernate.ddl-auto</span><span class="p">=</span><span class="s">update</span>

<span class="c"># H2 console
# http://localhost:8080/h2-console/
</span><span class="py">spring.h2.console.enabled</span><span class="p">=</span><span class="s">true</span>

</pre></table></code></div></div><p>The driver section is straightforward where the app reads db url and credentials. H2 database can be used as an in-memory datasource as well as it can persist the data to a <code class="language-plaintext highlighter-rouge">.db</code> file. For the url <code class="language-plaintext highlighter-rouge">~/be/db/expenses</code> a local file <code class="language-plaintext highlighter-rouge">expenses.mv.db</code> created in local storage.</p><p>In the second section, <code class="language-plaintext highlighter-rouge">spring.jpa.hibernate.ddl-auto</code> property tells springboot to create tables out of the ORM Entity classes. For this example entity class called Expense is considered. Few annotations added to the class / fields to make up table and it’s columns.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>
<span class="nd">@Entity</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s">"expenses"</span><span class="p">)</span>
<span class="kd">data class</span> <span class="nc">Expense</span><span class="p">(</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="p">=</span> <span class="nc">GenerationType</span><span class="p">.</span><span class="nc">IDENTITY</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span> <span class="p">=</span> <span class="mi">0</span><span class="p">,</span>

    <span class="nd">@Column</span><span class="p">(</span><span class="n">nullable</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">"amount"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">amount</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>

    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s">"remarks"</span><span class="p">,</span> <span class="n">nullable</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">remarks</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>

    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s">"is_income"</span><span class="p">,</span> <span class="n">nullable</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">isIncome</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">?</span> <span class="p">=</span> <span class="k">false</span>
<span class="p">)</span>

</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">H2 Console</code> section enables the web interface to the h2 database. It will be available at <code class="language-plaintext highlighter-rouge">http://localhost:8080/h2-console/</code> once the application started. With current setup, it should show the <code class="language-plaintext highlighter-rouge">expenses</code> table with no records in it.</p><p><img data-proofer-ignore data-src="/assets/img/2021-05-25-22-13-58.png" alt="" /></p><p class="figcaption">H2 console web interface</p><h3 id="orm--jpa-repository">ORM — JPA repository</h3><p>JPA can be added to the project with following gradle dependency.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">//File: build.gradle.kts</span>

<span class="c1">// JPA</span>
<span class="nf">implementation</span><span class="p">(</span><span class="s">"org.springframework.boot:spring-boot-starter-data-jpa:2.5.0"</span><span class="p">)</span>

</pre></table></code></div></div><p>In springboot, repository is an interface makes a skeleton for entity and it’s primary key. The repository for the expenses entity is a simple one line interface. Based on the need, complex queries can be declared in the repository.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>
<span class="kd">interface</span> <span class="nc">ExpenseRepository</span> <span class="p">:</span> <span class="nc">JpaRepository</span><span class="p">&lt;</span><span class="nc">Expense</span><span class="p">,</span> <span class="nc">Int</span><span class="p">&gt;</span>

</pre></table></code></div></div><p>On top of common CRUD operations, JpaRepository covers sort/filter/pagination usecases as well. To give an idea on what are all the operations that we get from JPA, pasted the original JpaRepository interface below.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">ID</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">PagingAndSortingRepository</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">ID</span><span class="o">&gt;,</span> <span class="nc">QueryByExampleExecutor</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
   <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">();</span>
   <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="nc">Sort</span> <span class="n">sort</span><span class="o">);</span>
   <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">findAllById</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">&lt;</span><span class="no">ID</span><span class="o">&gt;</span> <span class="n">ids</span><span class="o">);</span>   
   <span class="o">&lt;</span><span class="no">S</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">S</span><span class="o">&gt;</span> <span class="nf">saveAll</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">&lt;</span><span class="no">S</span><span class="o">&gt;</span> <span class="n">entities</span><span class="o">);</span>
   <span class="kt">void</span> <span class="nf">flush</span><span class="o">();</span>
   <span class="o">&lt;</span><span class="no">S</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;</span> <span class="no">S</span> <span class="nf">saveAndFlush</span><span class="o">(</span><span class="no">S</span> <span class="n">entity</span><span class="o">);</span>
   <span class="kt">void</span> <span class="nf">deleteInBatch</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">entities</span><span class="o">);</span>
   <span class="kt">void</span> <span class="nf">deleteAllInBatch</span><span class="o">();</span>
   <span class="no">T</span> <span class="nf">getOne</span><span class="o">(</span><span class="no">ID</span> <span class="n">id</span><span class="o">);</span>
   <span class="o">&lt;</span><span class="no">S</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">S</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="nc">Example</span><span class="o">&lt;</span><span class="no">S</span><span class="o">&gt;</span> <span class="n">example</span><span class="o">);</span>
   <span class="o">&lt;</span><span class="no">S</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">S</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="nc">Example</span><span class="o">&lt;</span><span class="no">S</span><span class="o">&gt;</span> <span class="n">example</span><span class="o">,</span> <span class="nc">Sort</span> <span class="n">sort</span><span class="o">);</span>
<span class="o">}</span>

</pre></table></code></div></div><h3 id="graphql-setup">GraphQL setup</h3><p>For GraphQL, Netflix DGS is used in this project, for two main reasons. It generates models out of schema &amp; it registers fetchers and data loaders with few annotations. Following changes required in build file to add dgs to the project.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nf">plugins</span> <span class="p">{</span>

    <span class="c1">// Code generation plugin</span>
    <span class="nf">id</span><span class="p">(</span><span class="s">"com.netflix.dgs.codegen"</span><span class="p">)</span> <span class="n">version</span> <span class="s">"4.6.4"</span>

<span class="p">}</span>

<span class="n">tasks</span><span class="p">.</span><span class="n">withType</span><span class="p">&lt;</span><span class="n">com</span><span class="p">.</span><span class="n">netflix</span><span class="p">.</span><span class="n">graphql</span><span class="p">.</span><span class="n">dgs</span><span class="p">.</span><span class="n">codegen</span><span class="p">.</span><span class="n">gradle</span><span class="p">.</span><span class="nc">GenerateJavaTask</span><span class="p">&gt;</span> <span class="p">{</span>
     <span class="n">packageName</span> <span class="p">=</span> <span class="s">"com.ex2.gql.dgmodels"</span>
     <span class="n">schemaPaths</span> <span class="p">=</span> <span class="nf">mutableListOf</span><span class="p">(</span><span class="s">"${projectDir}/src/main/resources/schema"</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">dependencies</span> <span class="p">{</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.netflix.graphql.dgs:graphql-dgs-spring-boot-starter:3.12.1"</span><span class="p">)</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Here, the <code class="language-plaintext highlighter-rouge">com.netflix.dgs.codegen</code> plugin reads schema file placed in resource directory and generate classes. <code class="language-plaintext highlighter-rouge">com.netflix.graphql.dgs:graphql-dgs-spring-boot-starter</code> takes care of connecting the data fetchers(REST controller equivalent) &amp; loaders (layers in between fetcher and repository) to the main application.</p><h2 id="pagination-and-filter-setup">Pagination and Filter setup</h2><h3 id="what-paginates-the-data-source">What paginates the data source?</h3><p>The key player in this post is the following method in JPARepository. Although this post drives towards GraphQL, any form of API can make use of the core logic in below method.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>
<span class="c1">//File:"QueryByExampleExecutor.java"</span>

   <span class="o">&lt;</span><span class="no">S</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;</span> <span class="nc">Page</span><span class="o">&lt;</span><span class="no">S</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="nc">Example</span><span class="o">&lt;</span><span class="no">S</span><span class="o">&gt;</span> <span class="n">example</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>

</pre></table></code></div></div><p>This method takes in a probe object to filter the data source with and directives for paging and sorting. This probe object can be the one extended from our entity or entity object itself. Any field that is not required for filtering, can be set to null.</p><p><code class="language-plaintext highlighter-rouge">findAll</code> delivers result in a wrapper class called <code class="language-plaintext highlighter-rouge">Page</code>, which contains the subset (a chunk of items) and blueprint of over all data set (total number of pages). This total pages will be used at the client end to stop fetching further from the list.</p><h3 id="schema">Schema</h3><p>In GraphQL schema drives the rest of the project, the surface setup and then the underlying machanics are built. DGS framework takes care of code generation when the schema file is present in right resource folder.</p><p>For this post, expected model is a page of expenses which provides meta info regarding the total number of pages and current page number. The schema will look like this.</p><div class="language-graphql highlighter-rouge"><div class="code-header"> <span text-data=" GraphQL "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="w">
</span><span class="k">input</span><span class="w"> </span><span class="n">ExpenseFilter</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">isIncome</span><span class="p">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="k">type</span><span class="w"> </span><span class="n">Expense</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nb">ID</span><span class="w">
    </span><span class="n">remarks</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w">
    </span><span class="n">amount</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="w">
    </span><span class="n">isIncome</span><span class="p">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="k">type</span><span class="w"> </span><span class="n">ExpensePage</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">list</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">Expense</span><span class="p">]</span><span class="w">
    </span><span class="n">totalPages</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="w">
    </span><span class="n">currentPage</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="k">type</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="p">{</span><span class="w">

    </span><span class="n">fetchExpenses</span><span class="p">(</span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="n">ExpenseFilter</span><span class="p">,</span><span class="w"> </span><span class="n">pageNumber</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">,</span><span class="w"> </span><span class="n">pageSize</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ExpensePage</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></pre></table></code></div></div><p>Here, <code class="language-plaintext highlighter-rouge">Expense</code> denotes single item in expenses list, <code class="language-plaintext highlighter-rouge">ExpensePage</code> is a wrapper that holds list of expenses and page info. Provided these types, dgs-codegn plugin will generate classes based on type and field names. These classes will be used in later sections to connect with ORM.</p><p><code class="language-plaintext highlighter-rouge">ExpenseFilter</code> is a class that represents filter for expense entity, more on this covered in data fetchers section. <code class="language-plaintext highlighter-rouge">fetchExpenses</code> is a query operation for GraphQL, it takes filter, pageNumber and pageSize as arguments and returns ExpensePage.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">// Generated — Expense Page class</span>
<span class="k">public</span> <span class="kd">data class</span> <span class="nc">ExpensePage</span><span class="p">(</span>
  <span class="nd">@JsonProperty</span><span class="p">(</span><span class="s">"list"</span><span class="p">)</span>
  <span class="k">public</span> <span class="kd">val</span> <span class="py">list</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Expense</span><span class="p">?&gt;?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
  <span class="nd">@JsonProperty</span><span class="p">(</span><span class="s">"totalPages"</span><span class="p">)</span>
  <span class="k">public</span> <span class="kd">val</span> <span class="py">totalPages</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
  <span class="nd">@JsonProperty</span><span class="p">(</span><span class="s">"currentPage"</span><span class="p">)</span>
  <span class="k">public</span> <span class="kd">val</span> <span class="py">currentPage</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">companion</span> <span class="k">object</span>
<span class="p">}</span>

</pre></table></code></div></div><h3 id="data-fetchers">Data fetchers</h3><p>A DataFetcher is where GraphQL compose the response from entity. Query mentioned in <code class="language-plaintext highlighter-rouge">Query#fetchExpenses</code> is materialized here to fetch data from the database. These classes must be marked as <code class="language-plaintext highlighter-rouge">DgsComponent</code> to be considered as a graphql component. It can contain number of graphQL operations annotated matching the signature in schema. To connect with database, <code class="language-plaintext highlighter-rouge">ExpenseRepository</code> reference is created to use inside the data fetcher.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>
<span class="nd">@DgsComponent</span>
<span class="kd">class</span> <span class="nc">ExpenseDataFetcher</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">expenseRepository</span><span class="p">:</span> <span class="nc">ExpenseRepository</span>

</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">fetchExpenses</code> operation can be hooked to a method as in below. Arguments are appropriately annotated with field names from the schema. Input and output classes are the DGS generated ones.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>    <span class="nd">@DgsData</span><span class="p">(</span><span class="n">parentType</span> <span class="p">=</span> <span class="s">"Query"</span><span class="p">,</span> <span class="n">field</span> <span class="p">=</span> <span class="s">"expenses"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">expenses</span><span class="p">(</span>
        <span class="nd">@InputArgument</span><span class="p">(</span><span class="s">"filter"</span><span class="p">)</span> <span class="n">filter</span><span class="p">:</span> <span class="nc">ExpenseFilter</span><span class="p">?,</span>
        <span class="nd">@InputArgument</span><span class="p">(</span><span class="s">"pageNumber"</span><span class="p">)</span> <span class="n">pageNumber</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
        <span class="nd">@InputArgument</span><span class="p">(</span><span class="s">"pageSize"</span><span class="p">)</span> <span class="n">pageSize</span><span class="p">:</span> <span class="nc">Int</span>
    <span class="p">):</span> <span class="nc">ExpensePage</span> <span class="p">{</span>
</pre></table></code></div></div><p><strong>Filter</strong> for JPA can be provided by creating an example object with matching values and passes to the <code class="language-plaintext highlighter-rouge">expenseRepository.findAll</code> function. If <code class="language-plaintext highlighter-rouge">null</code> field passed to the example object, it will not be considered for filtering.</p><p>The findAll function also takes in a <code class="language-plaintext highlighter-rouge">PageRequest</code> object as second argument to provide <strong>pagination</strong>. This page request requires pageNumber, size and an optional Sort parameter.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>        <span class="kd">val</span> <span class="py">probe</span> <span class="p">=</span> <span class="nc">Expense</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
            <span class="n">remarks</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
            <span class="n">isIncome</span> <span class="p">=</span> <span class="n">filter</span><span class="o">?.</span><span class="n">isIncome</span><span class="p">,</span>
            <span class="n">amount</span> <span class="p">=</span> <span class="k">null</span>
        <span class="p">)</span>
        <span class="kd">val</span> <span class="py">example</span> <span class="p">=</span> <span class="nc">Example</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span><span class="n">probe</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">pageRequest</span> <span class="p">=</span> <span class="nc">PageRequest</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span>
            <span class="n">pageNumber</span><span class="p">,</span> <span class="n">pageSize</span><span class="p">,</span> <span class="nc">Sort</span><span class="p">.</span><span class="k">by</span><span class="p">(</span>
                <span class="nc">Sort</span><span class="p">.</span><span class="nc">Order</span><span class="p">.</span><span class="nf">desc</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="kd">val</span> <span class="py">result</span><span class="p">:</span> <span class="nc">Page</span><span class="p">&lt;</span><span class="nc">Expense</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">expenseRepository</span><span class="p">.</span><span class="nf">findAll</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">pageRequest</span><span class="p">)</span>
</pre></table></code></div></div><p>So far, the result is of type <code class="language-plaintext highlighter-rouge">Page&lt;Expense&gt;</code>, this is close to the <code class="language-plaintext highlighter-rouge">ExpensePage</code> defined in schema but not exactly the same. So, the last part is to convert JPAEntity to GraphQL — Object. For this matter, a utility class called <code class="language-plaintext highlighter-rouge">ExpenseGEMapper</code> is used, it basically reads each field from Jpa model and assigns it to graphql model. Implementation can be found below.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>        <span class="kd">val</span> <span class="py">list</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span>
            <span class="nc">ExpenseGEMapper</span><span class="p">.</span><span class="nf">toGraph</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nc">ExpensePage</span><span class="p">(</span>
            <span class="n">list</span> <span class="p">=</span> <span class="n">list</span><span class="p">,</span>
            <span class="n">totalPages</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">totalPages</span><span class="p">,</span>
            <span class="n">currentPage</span> <span class="p">=</span> <span class="n">pageNumber</span>
        <span class="p">)</span>
    <span class="p">}</span>

</pre></table></code></div></div><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>
<span class="c1">//File:"ExpenseGEMapper.kt"</span>

<span class="k">import</span> <span class="nn">com.ex2.gql.expense.jpa.entities.Expense</span> <span class="k">as</span> <span class="nc">EExpense</span>
<span class="k">import</span> <span class="nn">com.ex2.gql.dgmodels.types.Expense</span> <span class="k">as</span> <span class="nc">GExpense</span>

<span class="kd">object</span> <span class="nc">ExpenseGEMapper</span> <span class="p">:</span> <span class="nc">GraphEntityMapper</span><span class="p">&lt;</span><span class="nc">GExpense</span><span class="p">,</span> <span class="nc">EExpense</span><span class="p">&gt;</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toGraph</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">EExpense</span><span class="p">):</span> <span class="nc">GExpense</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nc">GExpense</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="o">?.</span><span class="nf">toString</span><span class="p">(),</span>
            <span class="n">remarks</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">remarks</span><span class="p">,</span>
            <span class="n">acNumber</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">acNumber</span><span class="p">,</span>
            <span class="n">isIncome</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">isIncome</span><span class="p">,</span>
            <span class="n">amount</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span>
            <span class="n">account</span> <span class="p">=</span> <span class="k">null</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toEntity</span><span class="p">(</span><span class="n">g</span><span class="p">:</span> <span class="nc">GExpense</span><span class="p">):</span> <span class="nc">EExpense</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nc">EExpense</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">id</span><span class="o">?.</span><span class="nf">toInt</span><span class="p">(),</span>
            <span class="n">remarks</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">remarks</span><span class="p">,</span>
            <span class="n">acNumber</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">acNumber</span><span class="p">,</span>
            <span class="n">isIncome</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">isIncome</span><span class="p">,</span>
            <span class="n">amount</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">amount</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>With above function, the pagination &amp; filter is complete. The expense data fetcher class is available <a href="https://github.com/mahendranv/spring-expenses/blob/main/src/main/kotlin/com/ex2/gql/expense/fetchers/ExpenseDataFetcher.kt">here</a> for reference.</p><h2 id="run-it">Run it</h2><p>GraphiQL playground is available in <code class="language-plaintext highlighter-rouge">http://localhost:8080/graphiql</code> to try the queries. Given the filter/page details, it returs the list, and page number to query further in the list. Clients can query until <code class="language-plaintext highlighter-rouge">totalPages</code>.</p><div class="language-json highlighter-rouge"><div class="code-header"> <span text-data=" Json "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="w">
</span><span class="err">query</span><span class="w"> </span><span class="err">Expense</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="err">fetchExpenses(filter:</span><span class="w"> </span><span class="p">{</span><span class="err">isIncome:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w"> </span><span class="err">pageSize:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="err">pageNumber:</span><span class="w"> </span><span class="mi">0</span><span class="err">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">list</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="err">id</span><span class="w">
      </span><span class="err">remarks</span><span class="w">
      </span><span class="err">amount</span><span class="w">      
    </span><span class="p">}</span><span class="w">
    </span><span class="err">totalPages</span><span class="w">
    </span><span class="err">currentPage</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">###</span><span class="w"> </span><span class="err">response</span><span class="w">

</span><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"expenses"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"list"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"295"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"remarks"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Book MK"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="err">...</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"286"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"remarks"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Book MK"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"totalPages"</span><span class="p">:</span><span class="w"> </span><span class="mi">27</span><span class="p">,</span><span class="w">
      </span><span class="nl">"currentPage"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></pre></table></code></div></div><h2 id="summary">Summary</h2><p>A graphQL schema, ORM and data fetcher work together to make an API paginated. As number of filter fields increase, GraphQL will scale gracefully with very little code change where only the ExpenseFilter to Example class conversion is affected.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/graphql/'>GraphQL</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/graphql/" class="post-tag no-text-decoration" >graphql</a> <a href="/tags/springboot/" class="post-tag no-text-decoration" >springboot</a> <a href="/tags/kotlin/" class="post-tag no-text-decoration" >kotlin</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=GraphQL backend — pagination & filters - Mahendran&url=https://mahendranv.github.io/posts/gql-filters-pagination/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=GraphQL backend — pagination & filters - Mahendran&u=https://mahendranv.github.io/posts/gql-filters-pagination/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=GraphQL backend — pagination & filters - Mahendran&url=https://mahendranv.github.io/posts/gql-filters-pagination/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/hilt-instrument/">Android — Instrumentation test with hilt</a><li><a href="/posts/hilt-codegen/">Smoke, mirrors & HiltViewModel</a><li><a href="/posts/hilt-viewmodel/">Android — Basic Hilt setup with viewmodel + fragment</a><li><a href="/posts/viewmodel-store/">Android — ViewModel factory and instantiation</a><li><a href="/posts/compose-shapes-gists/">I created few shapes in Jetpack compose / Gist included</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/graphql/">graphql</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/compose/">compose</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/hilt/">hilt</a> <a class="post-tag" href="/tags/dagger/">dagger</a> <a class="post-tag" href="/tags/dribbble/">dribbble</a> <a class="post-tag" href="/tags/tools/">tools</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/gql-simple-backend/"><div class="card-body"> <span class="timeago small" >May 17, 2021<i class="unloaded">2021-05-17T00:00:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GraphQL - simple backend server - SpringBoot application</h3><div class="text-muted small"><p> In this post, I’ll cover how to create a simple GraphQL server with Springboot and Netflix DGS. DGS is chosen because you start with GraphQL schema and then build server side logic around it. P...</p></div></div></a></div><div class="card"> <a href="/posts/gql-delete-update/"><div class="card-body"> <span class="timeago small" >May 18, 2021<i class="unloaded">2021-05-18T00:00:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GraphQL backend — update & delete</h3><div class="text-muted small"><p> In the first installment, I covered create and read operations to the Expense entity. Now let’s add few more operations ⇨ update and delete queries. Entire source code is available in github. For ...</p></div></div></a></div><div class="card"> <a href="/posts/gql-nested-objects/"><div class="card-body"> <span class="timeago small" >May 20, 2021<i class="unloaded">2021-05-20T00:00:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GraphQL backend — nested objects</h3><div class="text-muted small"><p> A nested object is like a Matryoshka doll where one object placed inside another and you can choose to not open the next level — a perfect usecase to demonstrate the power of GraphQL. In this post...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/gql-data-loaders/" class="btn btn-outline-primary" prompt="Older"><p>GraphQL backend — data loaders</p></a> <a href="/posts/length-of-substring/" class="btn btn-outline-primary" prompt="Newer"><p>Kotlin solution for the longest Substring Without Repeating Characters</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/mahevelai">Mahendran Vadivalagan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/graphql/">graphql</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/compose/">compose</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/hilt/">hilt</a> <a class="post-tag" href="/tags/dagger/">dagger</a> <a class="post-tag" href="/tags/dribbble/">dribbble</a> <a class="post-tag" href="/tags/tools/">tools</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://mahendranv.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
