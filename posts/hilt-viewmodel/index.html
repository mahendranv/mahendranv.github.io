<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Android — Basic Hilt setup with viewmodel + fragment" /><meta property="og:locale" content="en" /><meta name="description" content="Hilt is a modern android DI framework for dependency injection. It is merely a wrapper around Dagger2. Forget dagger-android, hilt brings a lot to our plate. This article covers steps to add hilt to the project and use along with viewmodel-fragment." /><meta property="og:description" content="Hilt is a modern android DI framework for dependency injection. It is merely a wrapper around Dagger2. Forget dagger-android, hilt brings a lot to our plate. This article covers steps to add hilt to the project and use along with viewmodel-fragment." /><link rel="canonical" href="https://mahendranv.github.io/posts/hilt-viewmodel/" /><meta property="og:url" content="https://mahendranv.github.io/posts/hilt-viewmodel/" /><meta property="og:site_name" content="Mahendran" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-28T00:00:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Android — Basic Hilt setup with viewmodel + fragment" /><meta name="twitter:site" content="@mahevelai" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"Android — Basic Hilt setup with viewmodel + fragment","dateModified":"2021-09-28T00:00:00+05:30","datePublished":"2021-09-28T00:00:00+05:30","description":"Hilt is a modern android DI framework for dependency injection. It is merely a wrapper around Dagger2. Forget dagger-android, hilt brings a lot to our plate. This article covers steps to add hilt to the project and use along with viewmodel-fragment.","url":"https://mahendranv.github.io/posts/hilt-viewmodel/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://mahendranv.github.io/posts/hilt-viewmodel/"},"@context":"https://schema.org"}</script><title>Android — Basic Hilt setup with viewmodel + fragment | Mahendran</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mahendran"><meta name="application-name" content="Mahendran"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/614333/01be055d-c668-46ba-8f7b-54065256c70d.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Mahendran</a></div><div class="site-subtitle font-italic">Android | Kotlin | Springboot | DGS</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/series/" class="nav-link"> <i class="fa-fw fas fas fa-list-ol ml-xl-3 mr-xl-3 unloaded"></i> <span>SERIES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/mahendranv" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/mahevelai" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://dev.to/mahendranv" aria-label="dev.to" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-dev"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Android — Basic Hilt setup with viewmodel + fragment</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Android — Basic Hilt setup with viewmodel + fragment</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Mahendran Vadivalagan </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Sep 28, 2021, 12:00 AM +0530" >Sep 28<i class="unloaded">2021-09-28T00:00:00+05:30</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="975 words">5 min read</span></div></div><div class="post-content"><p>Hilt is a modern android DI framework for dependency injection. It is merely a wrapper around Dagger2. Forget <a href="https://www.techyourchance.com/dagger-android-dead/">dagger-android</a>, hilt brings a lot to our plate. This article covers steps to add hilt to the project and use along with viewmodel-fragment.</p><p>…</p><p>This is the first installment in three part series.</p><p><strong>Part1: Android — Basic Hilt setup with viewmodel + fragment</strong></p><p><strong>Part2:</strong> Smoke, mirrors &amp; HiltViewModel</p><p><strong>Part3:</strong> Fakes and espresso</p><p>…</p><p>Sample project used for this article is available in <a href="https://github.com/mahendranv/hilt-espresso">github</a>.</p><h2 id="-what-are-we-injecting">💉 What are we injecting?</h2><p>For this example, we’re going to provide <code class="language-plaintext highlighter-rouge">Profile</code> (a POJO) to a fragment through <code class="language-plaintext highlighter-rouge">ViewModel</code>. For simplicity let’s not use <code class="language-plaintext highlighter-rouge">LiveData</code> in here. This is how the dependency graph looks like.</p><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/6584143/135462794-dfc37daa-96e7-49f3-bcda-35cc8f911e7d.png" alt="image" /></p><hr /><h2 id="-little-about-scope">🔘 Little about scope</h2><p>Dependencies could be of different scope (how long it can be in memory/when it can be garbage collected). When we speak about the scope of a dependency, we can easily define it in terms of android components. Below is the oversimplified version of commonly used scopes.</p><ol><li>A user session details should be available throughout the app (Singleton)<li>I have a tabbed screen and want to share some in-memory fields between fragments (Activity)<li>My data is bound to current screen/fragment. When it is destroyed purge the dependency as well (Fragment)<li>Associate my dependency with ViewModel. Depends on the viewmodel’s scope (activity / fragment) let my dependency live (ViewModelScope)</ol><p>For our use-case, we’ll inject DataRepository to the viewmodel using hilt. And there are few improvements on creating viewmodel for the fragment. We’ll see it end to end in the following section.</p><hr /><h2 id="-code-it">💻 Code it</h2><h3 id="build-setup">Build setup</h3><p>Like any framework we write less with hilt because most of the code is <code class="language-plaintext highlighter-rouge">generated</code> for us. For that purpose, we’ll use hilt gradle plugin. And, hilt is expected to be used in multiple modules, so extract out the version to project level gradle file and use it in submodules.</p><div class="language-gradle highlighter-rouge"><div class="code-header"> <span text-data=" Gradle "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">// File: build.gradle</span>

<span class="k">buildscript</span> <span class="o">{</span>
    <span class="n">ext</span> <span class="o">{</span>
        <span class="n">hilt_version</span> <span class="o">=</span> <span class="s1">'2.38.1'</span>
    <span class="o">}</span>
    <span class="k">repositories</span> <span class="o">{</span>
        <span class="c1">// redacted</span>
    <span class="o">}</span>
    <span class="k">dependencies</span> <span class="o">{</span>
        <span class="c1">// redacted</span>
        <span class="n">classpath</span> <span class="s2">"com.google.dagger:hilt-android-gradle-plugin:${hilt_version}"</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><div class="language-gradle highlighter-rouge"><div class="code-header"> <span text-data=" Gradle "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1">// File: app/build.gradle</span>

<span class="n">plugins</span> <span class="o">{</span>
    <span class="n">id</span> <span class="s1">'com.android.application'</span>
    <span class="n">id</span> <span class="s1">'kotlin-android'</span>
    <span class="n">id</span> <span class="s1">'dagger.hilt.android.plugin'</span>
<span class="o">}</span>

<span class="k">dependencies</span> <span class="o">{</span>
    <span class="c1">// Hilt</span>
    <span class="n">implementation</span> <span class="s2">"com.google.dagger:hilt-android:${hilt_version}"</span>
    <span class="n">kapt</span> <span class="s2">"com.google.dagger:hilt-compiler:${hilt_version}"</span>

    <span class="c1">// Fragment / viewmodel</span>
    <span class="kt">def</span> <span class="n">lifecycle</span> <span class="o">=</span> <span class="s2">"2.3.1"</span>
    <span class="n">implementation</span> <span class="s2">"androidx.lifecycle:lifecycle-viewmodel-ktx:${lifecycle}"</span>
    <span class="n">implementation</span> <span class="s2">"androidx.lifecycle:lifecycle-livedata-ktx:${lifecycle}"</span>
    <span class="n">implementation</span> <span class="s2">"androidx.fragment:fragment-ktx:1.3.6"</span>
<span class="o">}</span>
</pre></table></code></div></div><p>In the project level gradle we tell the build system to use hilt. And the app level gradle applies the plugin so that it can skim through our codebase and generate dependencies for us.</p><p>…</p><h3 id="hiltandroidapp-setup-application-context">HiltAndroidApp setup (application context)</h3><p>A singleton is expected to be alive through the app session. Here, the dependency lives with application. In order to tell hilt about the application scope, create and annotate application class with <code class="language-plaintext highlighter-rouge">HiltAndroidApp</code>.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">android.app.Application</span>
<span class="k">import</span> <span class="nn">dagger.hilt.android.HiltAndroidApp</span>

<span class="nd">@HiltAndroidApp</span>
<span class="kd">class</span> <span class="nc">MyApp</span> <span class="p">:</span> <span class="nc">Application</span><span class="p">()</span>
</pre></table></code></div></div><p>Above step is needed because the application context is provided through generated application class. Make the project and inspect the contents of <code class="language-plaintext highlighter-rouge">Hilt_MyApp</code> class.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">// generated source</span>
<span class="nc">DaggerMyApp_HiltComponents_SingletonC</span><span class="p">.</span><span class="nf">builder</span><span class="p">()</span>
          <span class="p">.</span><span class="nf">applicationContextModule</span><span class="p">(</span><span class="n">new</span> <span class="nc">ApplicationContextModule</span><span class="p">(</span><span class="nc">Hilt_MyApp</span><span class="p">.</span><span class="k">this</span><span class="p">))</span>
          <span class="p">.</span><span class="nf">build</span><span class="p">();</span>
</pre></table></code></div></div><p>Above steps enables smoother injection of application context to RoomDB / SharedPreference - what not.</p><p>…</p><h3 id="creating-data-source-and-modules">Creating data source and modules</h3><p>Code speaks <a href="https://fnune.com/2020/12/05/code-is-worth-a-thousand-words/">thousand words</a>. Below code block shows resource and the data source.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">// A resource</span>
<span class="kd">data class</span> <span class="nc">Profile</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">age</span><span class="p">:</span> <span class="nc">Int</span>
<span class="p">)</span>

<span class="c1">// A simple interface which returns the resource. </span>
<span class="c1">// This will help us mock the data source when executing tests.</span>
<span class="kd">interface</span> <span class="nc">DataRepository</span> <span class="p">{</span>

    <span class="k">fun</span> <span class="nf">getProfile</span><span class="p">():</span> <span class="nc">Profile</span>
<span class="p">}</span>

<span class="c1">// Simple implementation of data source</span>
<span class="kd">class</span> <span class="nc">DataRepoImpl</span> <span class="p">:</span> <span class="nc">DataRepository</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">getProfile</span><span class="p">():</span> <span class="nc">Profile</span> <span class="p">=</span>
        <span class="nc">Profile</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s">"Bruce Wayne"</span><span class="p">,</span> <span class="n">age</span> <span class="p">=</span> <span class="mi">42</span><span class="p">)</span>
<span class="p">}</span>

</pre></table></code></div></div><p>From here, we’ll work towards creating dependencies that can be recognized by Hilt.</p><p>First, annotate <code class="language-plaintext highlighter-rouge">DataRepoImpl</code> constructor with <code class="language-plaintext highlighter-rouge">@Inject</code>. This puts our class under Dagger/Hilt’s radar.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DataRepoImpl</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">()</span> <span class="p">:</span> <span class="nc">DataRepository</span> <span class="p">{</span>
</pre></table></code></div></div><p>Second, create a module that can provide dependency to view model.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nd">@InstallIn</span><span class="p">(</span><span class="nc">ViewModelComponent</span><span class="o">::</span><span class="k">class</span><span class="p">)</span> <span class="c1">// Scope our dependencies</span>
<span class="nd">@Module</span>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">ProfileModule</span> <span class="p">{</span>

    <span class="c1">// To be read as — When someone asks for DataRepository, create a DataRepoImpl and return it.</span>
    <span class="nd">@Binds</span>
    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">getProfileSource</span><span class="p">(</span><span class="n">repo</span><span class="p">:</span> <span class="nc">DataRepoImpl</span><span class="p">):</span> <span class="nc">DataRepository</span>
<span class="p">}</span>
</pre></table></code></div></div><p>…</p><h3 id="viewmodel-setup">Viewmodel setup</h3><p>ViewModels can tell ask hilt to provide dependencies. A simple way to ask dependencies is to mark viewmodel with <code class="language-plaintext highlighter-rouge">HiltViewModel</code> annotation.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nd">@HiltViewModel</span>
<span class="kd">class</span> <span class="nc">ProfileViewModel</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">repo</span><span class="p">:</span> <span class="nc">DataRepository</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">fun</span> <span class="nf">getProfile</span><span class="p">():</span> <span class="nc">Profile</span> <span class="p">=</span> <span class="n">repo</span><span class="p">.</span><span class="nf">getProfile</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Here we’re doing constructor injection on viewmodel. Doing the same without Hilt will require a <a href="https://developer.android.com/reference/androidx/lifecycle/ViewModelProvider.Factory">Factory</a> which pass on the dependencies to the constructor. Reason is the lifecycle of the viewmodel is managed by a lifecycle owner like activity/fragment. Internal mechanics of this injection is covered in last section. On to the fragment…</p><p>…</p><h3 id="fragment-setup">Fragment setup</h3><p>Fragment or activity is identified as <code class="language-plaintext highlighter-rouge">AndroidEntryPoint</code> in hilt. A fragment which is maked with <code class="language-plaintext highlighter-rouge">AndroidEntryPoint</code> will inject the dependencies without much boilerplate code. And this is our ProfileFragment which consumes the viewmodel.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@AndroidEntryPoint</span>
<span class="kd">class</span> <span class="nc">ProfileFragment</span> <span class="p">:</span> <span class="nc">Fragment</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">viewModel</span> <span class="k">by</span> <span class="n">viewModels</span><span class="p">&lt;</span><span class="nc">ProfileViewModel</span><span class="p">&gt;()</span>

    <span class="c1">// redacted</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onViewCreated</span><span class="p">(</span><span class="n">view</span><span class="p">:</span> <span class="nc">View</span><span class="p">,</span> <span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onViewCreated</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">savedInstanceState</span><span class="p">)</span>

        <span class="c1">// Here we go -- the profile resource is shown to the UI</span>
        <span class="n">view</span><span class="p">.</span><span class="n">findViewById</span><span class="p">&lt;</span><span class="nc">TextView</span><span class="p">&gt;(</span><span class="nc">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">name_label</span><span class="p">)</span>
            <span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">viewModel</span><span class="p">.</span><span class="nf">getProfile</span><span class="p">().</span><span class="n">name</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>That’s it!!</p><p>Nothing much changed, instead of creating a factory and use it in <code class="language-plaintext highlighter-rouge">viewModels</code> delegate we annotated with <code class="language-plaintext highlighter-rouge">AndroidEntryPoint</code>. And the resource is available to us and components are less coupled now.</p><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/6584143/135462680-9b99230e-ae7e-4170-88c9-c7fb5907a40f.png" alt="image" /></p><h2 id="-resources">📖 Resources</h2><ul><li><a href="https://github.com/mahendranv/hilt-espresso">Sample project source</a><li><a href="https://dagger.dev/">dagger.dev</a><li><a href="https://github.com/mahendranv/hilt-espresso/commit/2ea5e386283ee4064d11b73e03fe8b31dfa69c25">Commit: migrating from manual injection to hilt</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/android/'>Android</a>, <a href='/categories/hilt/'>Hilt</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >android</a> <a href="/tags/hilt/" class="post-tag no-text-decoration" >hilt</a> <a href="/tags/dagger/" class="post-tag no-text-decoration" >dagger</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Android — Basic Hilt setup with viewmodel + fragment - Mahendran&url=https://mahendranv.github.io/posts/hilt-viewmodel/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Android — Basic Hilt setup with viewmodel + fragment - Mahendran&u=https://mahendranv.github.io/posts/hilt-viewmodel/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Android — Basic Hilt setup with viewmodel + fragment - Mahendran&url=https://mahendranv.github.io/posts/hilt-viewmodel/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/viewmodel-store/">Android — ViewModel factory and instantiation</a><li><a href="/posts/compose-shapes-gists/">I created few shapes in Jetpack compose / Gist included</a><li><a href="/posts/compose-shapes/">Jetpack compose - shape your views</a><li><a href="/posts/timer/">Android — Implementing LifecycleAwareTimer</a><li><a href="/posts/bon-apetit/">Hackerrank - bon-appetit problem solution in Kotlin</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/graphql/">graphql</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/compose/">compose</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/dribbble/">dribbble</a> <a class="post-tag" href="/tags/tools/">tools</a> <a class="post-tag" href="/tags/beginners/">beginners</a> <a class="post-tag" href="/tags/blog/">blog</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/kotlin-safe-cast/"><div class="card-body"> <span class="timeago small" >Apr 14<i class="unloaded">2021-04-14T00:00:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kotlin safe casting</h3><div class="text-muted small"><p> In multiple cases you might’ve came across the situation where you have to cast a global variable and check the instance beforehand. A most common case in Android environment is to check whether...</p></div></div></a></div><div class="card"> <a href="/posts/kotlin-value-class/"><div class="card-body"> <span class="timeago small" >May 1<i class="unloaded">2021-05-01T00:00:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kotlin value class</h3><div class="text-muted small"><p> Kotlin’s data class is a fan favorite when it comes to storing any model. Bundled with bunch of necessary methods, devs get a lot while writing way less. From Kotlin 1.5 — we have value class-s. L...</p></div></div></a></div><div class="card"> <a href="/posts/live-template/"><div class="card-body"> <span class="timeago small" >May 19<i class="unloaded">2021-05-19T00:00:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Quickguide to intellij live template</h3><div class="text-muted small"><p> LiveTemplate is a feature in Intellij based IDEs where you can expand a code snippet by typing an abbreviation and the IDE guide your cursor through the parts that need your attention (a variable n...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/compose-bottom-bar/" class="btn btn-outline-primary" prompt="Older"><p>Designing a bottom navigation bar with Jetpack compose</p></a> <a href="/posts/viewmodel-store/" class="btn btn-outline-primary" prompt="Newer"><p>Android — ViewModel factory and instantiation</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/mahevelai">Mahendran Vadivalagan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/graphql/">graphql</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/compose/">compose</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/dribbble/">dribbble</a> <a class="post-tag" href="/tags/tools/">tools</a> <a class="post-tag" href="/tags/beginners/">beginners</a> <a class="post-tag" href="/tags/blog/">blog</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://mahendranv.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
